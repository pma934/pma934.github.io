import{_ as b,c as a,b as e,e as g,w as u,f as m,o as l,a as k,d as h,t as n,F as p,r as L,h as v,g as y,i as D,B as x,j as I}from"./index-J4qdpyZZ.js";const w={data(){return{selectDom:null}},props:{directory:{type:String,default:""},activeId:{type:String,default:""}},methods:{tagTo(s){const t=s.srcElement.dataset.id;document.getElementById(t).scrollIntoView()},select(s){this.selectDom&&(this.selectDom.dataset.active=!1);const t=Array.from(this.$refs.directory.children).find(o=>o.dataset.id===s);t.dataset.active=!0,t.scrollIntoView({block:"center"}),this.selectDom=t}},watch:{activeId(s){this.select(s)}}},H={class:"markdown-directory"},N={class:"markdown-directory-content"},O={class:"body"},C=["innerHTML"];function z(s,t,o,c,r,i){const d=m("el-scrollbar");return l(),a("div",H,[e("div",N,[t[1]||(t[1]=e("div",{class:"title"},"目录",-1)),g(d,{height:"460"},{default:u(()=>[e("div",O,[e("div",{innerHTML:o.directory,onClick:t[0]||(t[0]=(..._)=>i.tagTo&&i.tagTo(..._)),ref:"directory"},null,8,C)])]),_:1})])])}const A=b(w,[["render",z],["__scopeId","data-v-cff77af3"]]),T=function(s){return s.offsetParent?s.offsetTop+T(s.offsetParent):s.offsetTop},S={name:"OneCat"},$={class:"pikachu"};function V(s,t,o,c,r,i){return l(),a("div",$)}const E=b(S,[["render",V],["__scopeId","data-v-8bbb86b4"]]),M={components:{ArchiveDirectory:A,Pikachu:E},data(){return{directory:null,offsetTopList:[],activeId:"",loadingImg:new URL("/assets/loading-kLxQ-647.gif",import.meta.url).href,userData:null,titleScroll:!1,getOffsetTopListIsDoing:!0,resize:0,loading:!0,directoryNumber:0}},props:{number:{type:String,require:!0}},computed:{blog(){return this.$store.getters.getBlogById(+this.number)},blogHtml(){return this.blog?.blogHtml??""},title(){return this.blog?.title??""},time(){return this.blog?.time??""},labels(){return this.blog?.labels??[]},img(){return this.blog?.img??""},avatar(){return this.userData?.avatar_url??""},name(){return this.userData?.name??""},nextBlog(){return this.blog?this.$store.getters.getNextBlog(this.blog):null},lastBlog(){return this.blog?this.$store.getters.getLastBlog(this.blog):null}},async created(){this.$store.dispatch("checkUserData").then(s=>{s&&(this.userData=s)}),await this.getBlog(),await this.getDirectory(),await this.getOffsetTopList(),this.loading=!1,I.on("scroll",s=>{for(let t of this.offsetTopList)if(+t.offsetTop<=+s)this.activeId=t.id;else break})},async mounted(){},updated(){this.resize=this.$refs.blog.offsetHeight},methods:{async getBlog(){if(!this.blog){const s=await D({number:this.number});if(s?.data){const t=new x(s.data);this.$store.commit("setBlogs",[[+this.number,t]])}}},async getDirectory(){let s=document.createElement("div");s.innerHTML=this.blog.blogHtml;let t=Array.from(s.children).filter(o=>["H2","H3"].includes(o.tagName));this.directoryNumber=t.length,this.directory=t.map(o=>{const c=o.getAttribute("id"),r=o.tagName==="H2"?"h2":"h3";return`<a data-id="${c}" class="${r}">${c}</a>`}).join(""),s=null,t=null},async getOffsetTopList(){const s=Array.from(this.$refs.blog.children).filter(t=>["H2","H3"].includes(t.tagName)).map(t=>({id:t.id,offsetTop:T(t)-60-this.$store.state.headerOffset}));JSON.stringify(this.offsetTopList)!==JSON.stringify(s)?(this.offsetTopList=s,this.getOffsetTopListIsDoing=!0,setTimeout(()=>{this.getOffsetTopList()},333)):this.getOffsetTopListIsDoing=!1},beforeGetOffsetTopList(){this.getOffsetTopListIsDoing||this.getOffsetTopList()}},watch:{resize(){this.beforeGetOffsetTopList()}}},P={class:"header-wrap"},j=["src"],F={class:"header-container"},G={class:"title"},J={ref:"title-text",class:"title-text"},R=["title"],U=["src"],q={class:"name-time-labels"},Q={class:"name-time"},K={class:"name"},W={class:"time"},X={class:"labels"},Y={class:"markdown-body"},Z=["innerHTML"],tt={class:"end"},et={key:0,class:"license markdown-body"},st=["href"],it={class:"archive-content-footer"},rt={class:"footer-wrap"},ot=["src"],lt={class:"text previous"},at={class:"previous-title"},nt=["src"],ct={class:"text next"},dt={class:"next-title"};function gt(s,t,o,c,r,i){const d=m("el-image"),_=m("Pikachu"),B=m("ArchiveDirectory");return l(),a(p,null,[e("div",{class:v(["archive-content-header",r.loading?"loading":""])},[e("div",P,[g(d,{class:"img",src:i.img||r.loadingImg,fit:"cover",lazy:""},{placeholder:u(()=>[e("img",{class:"img",src:r.loadingImg},null,8,j)]),_:1},8,["src"]),e("header",F,[e("div",G,[e("div",J,[e("span",{title:i.title},n(i.title),9,R)],512)]),e("img",{class:"avatar",src:i.avatar},null,8,U),e("div",q,[e("div",Q,[e("div",K,n(i.name),1),e("div",W,n(i.time),1)]),e("div",X,[(l(!0),a(p,null,L(i.labels,f=>(l(),a("span",{key:f.name},n(f.name),1))),128))])])])])],2),e("div",{class:v(["archive-content",r.loading?"loading":""])},[e("div",Y,[e("div",{ref:"blog",innerHTML:i.blogHtml},null,8,Z)]),e("div",tt,[g(_),t[2]||(t[2]=e("span",{class:"text"},"END!",-1))]),i.blog?(l(),a("div",et,[e("span",null,[t[3]||(t[3]=y("原始链接：",-1)),e("a",{href:i.blog.url},n(i.blog.url),9,st)]),t[4]||(t[4]=e("br",null,null,-1)),t[5]||(t[5]=e("span",null,[y("许可协议："),e("a",{href:"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"},"知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议")],-1))])):h("",!0)],2),e("div",it,[e("div",rt,[i.lastBlog?(l(),a("div",{key:0,onClick:t[0]||(t[0]=f=>s.$router.push(`/archive/${i.lastBlog.number}`)),class:"router"},[g(d,{class:"background",src:i.lastBlog.img,fit:"cover",lazy:""},{placeholder:u(()=>[e("img",{class:"img",src:r.loadingImg},null,8,ot)]),_:1},8,["src"]),e("div",lt,[t[6]||(t[6]=e("div",{class:"previous-label"},"previous",-1)),e("div",at,n(i.lastBlog.title),1)])])):h("",!0),i.nextBlog?(l(),a("div",{key:1,onClick:t[1]||(t[1]=f=>s.$router.push(`/archive/${i.nextBlog.number}`)),class:"router"},[g(d,{class:"background",src:i.nextBlog.img,fit:"cover",lazy:""},{placeholder:u(()=>[e("img",{class:"img",src:r.loadingImg},null,8,nt)]),_:1},8,["src"]),e("div",ct,[t[7]||(t[7]=e("div",{class:"next-label"},"next",-1)),e("div",dt,n(i.nextBlog.title),1)])])):h("",!0)])]),r.directoryNumber?(l(),k(B,{key:0,directory:r.directory,"active-id":r.activeId,class:v(["directory",r.loading?"loading":""])},null,8,["directory","active-id","class"])):h("",!0)],64)}const ht=b(M,[["render",gt],["__scopeId","data-v-5e443bd7"]]);export{ht as default};
