import{_ as b,c as a,a as e,d as g,w as m,e as _,o as l,g as k,b as h,h as u,t as n,F as p,r as x,f as y,i as L,B as D,j as I}from"./index-CTG0Jds-.js";const w={data(){return{selectDom:null}},props:{directory:{type:String,default:""},activeId:{type:String,default:""}},methods:{tagTo(s){const t=s.srcElement.dataset.id;document.getElementById(t).scrollIntoView()},select(s){this.selectDom&&(this.selectDom.dataset.active=!1);const t=Array.from(this.$refs.directory.children).find(r=>r.dataset.id===s);t.dataset.active=!0,t.scrollIntoView({block:"center"}),this.selectDom=t}},watch:{activeId(s){this.select(s)}}},N={class:"markdown-directory"},H={class:"markdown-directory-content"},O={class:"body"},$=["innerHTML"];function C(s,t,r,c,o,i){const d=_("el-scrollbar");return l(),a("div",N,[e("div",H,[t[1]||(t[1]=e("div",{class:"title"},"目录",-1)),g(d,{height:"460"},{default:m(()=>[e("div",O,[e("div",{innerHTML:r.directory,onClick:t[0]||(t[0]=(...v)=>i.tagTo&&i.tagTo(...v)),ref:"directory"},null,8,$)])]),_:1})])])}const S=b(w,[["render",C],["__scopeId","data-v-cff77af3"]]),T=function(s){return s.offsetParent?s.offsetTop+T(s.offsetParent):s.offsetTop},z={name:"OneCat"},A={class:"pikachu"};function V(s,t,r,c,o,i){return l(),a("div",A)}const E=b(z,[["render",V],["__scopeId","data-v-8bbb86b4"]]),M={components:{ArchiveDirectory:S,Pikachu:E},data(){return{directory:null,offsetTopList:[],activeId:"",loadingImg:new URL("/assets/loading-kLxQ-647.gif",import.meta.url).href,userData:null,titleScroll:!1,getOffsetTopListIsDoing:!0,resize:0,loading:!0,directoryNumber:0}},props:{number:{type:String,require:!0}},computed:{blog(){return this.$store.getters.getBlogById(+this.number)},blogHtml(){return this.blog?.blogHtml??""},title(){return this.blog?.title??""},time(){return this.blog?.time??""},labels(){return this.blog?.labels??[]},img(){return this.blog?.img??""},avatar(){return this.userData?.avatar_url??""},name(){return this.userData?.name??""},nextBlog(){return this.blog?this.$store.getters.getNextBlog(this.blog):null},lastBlog(){return this.blog?this.$store.getters.getLastBlog(this.blog):null}},async created(){this.$store.dispatch("checkUserData").then(s=>{s&&(this.userData=s)}),await this.getBlog(),await this.getDirectory(),await this.getOffsetTopList(),this.loading=!1,I.on("scroll",s=>{for(let t of this.offsetTopList)if(+t.offsetTop<=+s)this.activeId=t.id;else break})},async mounted(){await this.$nextTick();const s=this.$refs["title-text"].offsetWidth,t=this.$refs["title-text"].parentNode.offsetWidth;s>t&&(this.titleScroll=!0)},updated(){this.resize=this.$refs.blog.offsetHeight},methods:{async getBlog(){if(!this.blog){const s=await L({number:this.number});if(s?.data){const t=new D(s.data);this.$store.commit("setBlogs",[[+this.number,t]])}}},async getDirectory(){let s=document.createElement("div");s.innerHTML=this.blog.blogHtml;let t=Array.from(s.children).filter(r=>["H2","H3"].includes(r.tagName));this.directoryNumber=t.length,this.directory=t.map(r=>{const c=r.getAttribute("id"),o=r.tagName==="H2"?"h2":"h3";return`<a data-id="${c}" class="${o}">${c}</a>`}).join(""),s=null,t=null},async getOffsetTopList(){const s=Array.from(this.$refs.blog.children).filter(t=>["H2","H3"].includes(t.tagName)).map(t=>({id:t.id,offsetTop:T(t)-60-this.$store.state.headerOffset}));JSON.stringify(this.offsetTopList)!==JSON.stringify(s)?(this.offsetTopList=s,this.getOffsetTopListIsDoing=!0,setTimeout(()=>{this.getOffsetTopList()},333)):this.getOffsetTopListIsDoing=!1},beforeGetOffsetTopList(){this.getOffsetTopListIsDoing||this.getOffsetTopList()}},watch:{resize(){this.beforeGetOffsetTopList()}}},P={class:"header-wrap"},W=["src"],j={class:"header-container"},F={class:"title"},G=["src"],J={class:"name-time-labels"},R={class:"name-time"},U={class:"name"},q={class:"time"},Q={class:"labels"},K={class:"markdown-body"},X=["innerHTML"],Y={class:"end"},Z={key:0,class:"license markdown-body"},tt=["href"],et={class:"archive-content-footer"},st={class:"footer-wrap"},it=["src"],ot={class:"text previous"},rt={class:"previous-title"},lt=["src"],at={class:"text next"},nt={class:"next-title"};function ct(s,t,r,c,o,i){const d=_("el-image"),v=_("Pikachu"),B=_("ArchiveDirectory");return l(),a(p,null,[e("div",{class:u(["archive-content-header",o.loading?"loading":""])},[e("div",P,[g(d,{class:"img",src:i.img||o.loadingImg,fit:"cover",loading:"lazy"},{placeholder:m(()=>[e("img",{class:"img",src:o.loadingImg},null,8,W)]),_:1},8,["src"]),e("header",j,[e("div",F,[e("div",{ref:"title-text",class:u(["title-text",o.titleScroll?"scroll":""])},[e("span",null,n(i.title),1)],2)]),e("img",{class:"avatar",src:i.avatar},null,8,G),e("div",J,[e("div",R,[e("div",U,n(i.name),1),e("div",q,n(i.time),1)]),e("div",Q,[(l(!0),a(p,null,x(i.labels,f=>(l(),a("span",{key:f.name},n(f.name),1))),128))])])])])],2),e("div",{class:u(["archive-content",o.loading?"loading":""])},[e("div",K,[e("div",{ref:"blog",innerHTML:i.blogHtml},null,8,X)]),e("div",Y,[g(v),t[2]||(t[2]=e("span",{class:"text"},"END!",-1))]),i.blog?(l(),a("div",Z,[e("span",null,[t[3]||(t[3]=y("原始链接：",-1)),e("a",{href:i.blog.url},n(i.blog.url),9,tt)]),t[4]||(t[4]=e("br",null,null,-1)),t[5]||(t[5]=e("span",null,[y("许可协议："),e("a",{href:"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"},"知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议")],-1))])):h("",!0)],2),e("div",et,[e("div",st,[i.lastBlog?(l(),a("div",{key:0,onClick:t[0]||(t[0]=f=>s.$router.push(`/archive/${i.lastBlog.number}`)),class:"router"},[g(d,{class:"background",src:i.lastBlog.img,fit:"cover",loading:"lazy"},{placeholder:m(()=>[e("img",{class:"img",src:o.loadingImg},null,8,it)]),_:1},8,["src"]),e("div",ot,[t[6]||(t[6]=e("div",{class:"previous-label"},"previous",-1)),e("div",rt,n(i.lastBlog.title),1)])])):h("",!0),i.nextBlog?(l(),a("div",{key:1,onClick:t[1]||(t[1]=f=>s.$router.push(`/archive/${i.nextBlog.number}`)),class:"router"},[g(d,{class:"background",src:i.nextBlog.img,fit:"cover",loading:"lazy"},{placeholder:m(()=>[e("img",{class:"img",src:o.loadingImg},null,8,lt)]),_:1},8,["src"]),e("div",at,[t[7]||(t[7]=e("div",{class:"next-label"},"next",-1)),e("div",nt,n(i.nextBlog.title),1)])])):h("",!0)])]),o.directoryNumber?(l(),k(B,{key:0,directory:o.directory,"active-id":o.activeId,class:u(["directory",o.loading?"loading":""])},null,8,["directory","active-id","class"])):h("",!0)],64)}const gt=b(M,[["render",ct],["__scopeId","data-v-ac2f54f6"]]);export{gt as default};
